<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>形成-DB 鉄道編成表</title>
    <style>
        :root { --car-width: 200px; --bg-color: #f8f9fa; }
        body { font-family: "Helvetica Neue", Arial, sans-serif; background: var(--bg-color); margin: 0; padding: 20px; }
        
        /* トップ画面のスタイル */
        .top-menu { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; padding: 20px; }
        .menu-card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); cursor: pointer; text-align: center; transition: transform 0.2s; }
        .menu-card:hover { transform: translateY(-5px); }
        .menu-card h3 { margin: 10px 0 5px; color: #333; }
        
        /* 編成表示のスタイル */
        .formation-container { display: none; background: white; border-radius: 20px; padding: 40px 20px; position: relative; overflow-x: auto; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
        .back-btn { display: inline-block; margin-bottom: 20px; padding: 10px 20px; background: #333; color: white; border-radius: 8px; text-decoration: none; cursor: pointer; }

        .car-list { display: flex; align-items: flex-end; gap: 0; min-width: max-content; padding-top: 50px; }
        
        /* 画像の位置調整（ここが重要！） */
        .car-container { position: relative; width: var(--car-width); flex-shrink: 0; margin-right: 100px; }
        .car-main-img { width: 100%; display: block; position: relative; z-index: 10; }
        
        /* パンタグラフの位置 */
        .panta { position: absolute; top: -25px; width: 50px; z-index: 15; }
        .panta-left { left: 20px; }
        .panta-right { right: 20px; }
        
        /* 台車の位置（車体の下に潜り込ませる） */
        .bogie { position: absolute; bottom: -12px; width: 60px; z-index: 5; }
        .bogie-left { left: 25px; }
        .bogie-right { right: 25px; }

        .car-id { text-align: center; margin-top: 15px; font-weight: bold; font-size: 18px; border-top: 3px solid #333; padding-top: 5px; }
        .side-info { position: absolute; left: 105%; top: 0; width: 180px; font-size: 12px; line-height: 1.4; color: #555; }
    </style>
</head>
<body>

<div id="top-view">
    <h1>形成-DB 編成図鑑</h1>
    <div id="menu-list" class="top-menu"></div>
</div>

<div id="detail-view" style="display:none;">
    <div class="back-btn" onclick="showTop()">← 戻る</div>
    <div id="formation-content" class="formation-container"></div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
<script>
let allData = [];
const PANTA_MAP = { '◇': 'p0', '＜': 'p1', '＞': 'p2', '<': 'py1', '>': 'py2' };

Papa.parse('data.csv', {
    download: true, header: true,
    complete: function(results) {
        allData = results.data.filter(r => r.編成名);
        showTop();
    }
});

function showTop() {
    document.getElementById('top-view').style.display = 'block';
    document.getElementById('detail-view').style.display = 'none';
    
    const menuList = document.getElementById('menu-list');
    menuList.innerHTML = '';
    
    const groups = [...new Set(allData.map(r => r.編成名))];
    groups.forEach(name => {
        const firstCar = allData.find(r => r.編成名 === name);
        const card = document.createElement('div');
        card.className = 'menu-card';
        card.innerHTML = `<h3>${name}</h3><p>${firstCar.形式}</p>`;
        card.onclick = () => showDetail(name);
        menuList.appendChild(card);
    });
}

function showDetail(name) {
    document.getElementById('top-view').style.display = 'none';
    document.getElementById('detail-view').style.display = 'block';
    const container = document.getElementById('formation-content');
    container.style.display = 'block';
    container.innerHTML = '';

    const cars = allData.filter(r => r.編成名 === name).sort((a,b) => a.号車 - b.号車);
    let html = `<div class="car-list">`;

    cars.forEach(row => {
        html += `
        <div class="car-container">
            ${row.左パンタ ? `<img src="images/${PANTA_MAP[row.左パンタ] || row.左パンタ}.png" class="panta panta-left">` : ''}
            ${row.右パンタ ? `<img src="images/${PANTA_MAP[row.右パンタ] || row.右パンタ}.png" class="panta panta-right">` : ''}
            
            <img src="images/${row.車体アイコン}.png" class="car-main-img">
            
            ${row.左台車 ? `<img src="images/${row.左台車}.png" class="bogie bogie-left">` : ''}
            ${row.rightBogie || row.右台車 ? `<img src="images/${row.右台車}.png" class="bogie bogie-right">` : ''}
            
            <div class="car-id">${row.車両番号}</div>
            <div class="side-info">
                <div><b>${row["車両情報(記述)"] || ''}</b></div>
                <div>${row.製造所 || ''}</div>
                <div>${row.落成日 || ''} 落成</div>
            </div>
        </div>`;
    });

    html += `</div>`;
    container.innerHTML = html;
}
</script>
</body>
</html>
